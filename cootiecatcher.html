<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Cootie Catcher</title>
    <!-- Load Three.js (latest stable version) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <h1 style="position: absolute; z-index: 10; top: 20px; left: 20px; color: white;">Interactive 3D Cootie Catcher</h1>
    
    <div id="fortune-display" style="position: absolute; z-index: 10; top: 80px; left: 20px; color: white; display: none;">
        <h2>Your Fortune:</h2>
        <p id="fortune-text"></p>
    </div>

    <script>
        // Check if Three.js has been loaded
        if (typeof THREE === 'undefined') {
            console.error("Three.js is not loaded correctly!");
        } else {
            console.log("Three.js loaded successfully!");

            // 1. Set up Three.js scene, camera, and renderer
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x888888);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            // 2. Fortune data
            const fortunes = {
                "Red": ["You will soon have a great opportunity!", "Beware of making hasty decisions."],
                "Blue": ["A new adventure is on the horizon.", "Take time to reflect before making any changes."],
                "Green": ["Good fortune will follow you this week.", "A challenge is ahead, but you are prepared."],
                "Yellow": ["You will receive good news very soon.", "An old friend will come back into your life."]
            };

            // 3. Create the cootie catcher (folded paper)
            const cootieCatcher = new THREE.Group();
            const geometry = new THREE.PlaneGeometry(2, 2, 1, 1); // A simple square plane for the cootie catcher
            const material = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, wireframe: true });
            
            // Create and fold the tabs (this will simulate the folding of the paper)
            const tabs = [];
            const tabColors = ["Red", "Blue", "Green", "Yellow"];
            
            for (let i = 0; i < 4; i++) {
                const tab = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({ color: 0xffffff }));
                tab.position.set((i % 2 === 0 ? 1 : -1) * 0.8, (i < 2 ? 1 : -1) * 0.8, 0.1);
                tab.rotation.set(0, 0, Math.PI / 4);
                cootieCatcher.add(tab);
                tabs.push(tab);
                
                // Add text to each tab
                const textGeometry = new THREE.TextGeometry(tabColors[i], {
                    font: new THREE.FontLoader().parse(fontJSON),
                    size: 0.2,
                    height: 0.05
                });
                const textMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
                const textMesh = new THREE.Mesh(textGeometry, textMaterial);
                textMesh.position.set(tab.position.x - 0.3, tab.position.y - 0.3, tab.position.z);
                cootieCatcher.add(textMesh);
            }

            scene.add(cootieCatcher);
            camera.position.z = 5;

            // 4. Raycaster for detecting clicks on tabs
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();

            // Update mouse position when clicked
            window.addEventListener('click', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                raycaster.updateMatrixWorld();
                const intersects = raycaster.intersectObjects(tabs);

                if (intersects.length > 0) {
                    const tab = intersects[0].object;
                    const index = tabs.indexOf(tab);
                    displayFortune(tabColors[index]);
                }
            });

            // 5. Show the fortune for the clicked tab
            function displayFortune(color) {
                const fortune = fortunes[color];
                const randomFortune = fortune[Math.floor(Math.random() * fortune.length)];
                document.getElementById('fortune-text').textContent = randomFortune;
                document.getElementById('fortune-display').style.display = 'block';
            }

            // 6. Animate the scene
            function animate() {
                requestAnimationFrame(animate);
                cootieCatcher.rotation.x += 0.01;
                cootieCatcher.rotation.y += 0.01;
                raycaster.updateMatrixWorld();
                renderer.render(scene, camera);
            }

            animate();
            
            // Resize the renderer when window size changes
            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            });

            // Mock font data (you would need to load an actual font file)
            const fontJSON = { "type": "Font", "data": { /* Add font data here */ } };
        }
    </script>
</body>
</html>
